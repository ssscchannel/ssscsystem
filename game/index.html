<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>晟自然遊戲室 V14-P9</title>
    
    <link rel="manifest" href="./manifest.json">
    
    <meta name="theme-color" content="#2b4b82"> 
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-192.png">

    <link rel="stylesheet" href="./style.css?v=14.9">
</head>
<body>

    <div id="app-container">

        <div id="screen-lobby" class="screen active">
            <div class="header-section">
                <div class="brand-row" onclick="APP.triggerAdmin()">
                    <img src="logo.jpg" class="logo-img" alt="Logo">
                    <span class="system-title">晟自然輔助系統</span>
                </div>
                
                <div class="title-area">
                    <span class="tap-hand left-hand">👇</span>
                    <div class="glitch-wrapper">
                        <h1 class="game-slogan" data-text="手速即分數">手速即分數</h1>
                    </div>
                    <span class="tap-hand left-hand">👇</span>
                </div>
            </div>

            <div class="leaderboard-container" id="leaderboard-grid">
                <div style="color:white; text-align:center; padding-top:50px;">載入中...</div>
            </div>

            <div class="footer-action">
                <button class="start-btn" onclick="APP.navTo('input')">
                    <span class="btn-glow"></span>
                    <span class="btn-text">START GAME</span>
                </button>
            </div>
        </div>

        <div id="screen-input" class="screen">
            <div class="app-nav-bar">
                <div class="nav-left">
				    <button class="nav-btn" onclick="APP.navTo('lobby')" style="background: transparent; border: none; box-shadow: none;">
					    <!-- 下面這行改首頁小按鈕 -->
						<svg viewBox="0 0 24 24" style="width: 22px; height: 22px; fill: #00d2ff;">
						<path d="M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"/>
						</svg>
					</button>
				</div>
				
                <div class="nav-center">遊戲設定</div>
                <div class="nav-right"></div>
            </div>

            <div class="mode-container scrollable-y">
                <div class="input-row">
                    <div class="input-group">
                        <label>學校</label>
                        <input type="text" id="input-school" class="input-field" maxlength="3" onchange="APP.savePref('school', this.value)">
                    </div>
                    <div class="input-group">
                        <label>玩家</label>
                        <input type="text" id="input-name" class="input-field" maxlength="6">
                    </div>
                </div>

                <div class="section-label">選擇題庫</div>
                <div class="bank-selector" id="bank-btn-group">
                    </div>

                <div class="section-label">競賽模式</div>
                <div class="mode-container">
                    <div class="mode-row">
                        <button id="m-std" class="mode-btn selected" onclick="APP.selectMode('standard')">
                            <span class="m-emoji">⏱️</span>
                            <span class="m-text">標準競速</span>
                        </button>
                        <button id="m-surv" class="mode-btn" onclick="APP.selectMode('survival')">
                            <span class="m-emoji">❤️</span>
                            <span class="m-text">生存挑戰</span>
                        </button>
                    </div>
                    <div class="mode-row">
                        <button id="m-f1" class="mode-btn" onclick="APP.selectMode('f1')">
                            <span class="m-emoji">🏎️</span>
                            <span class="m-text">F1 積分賽</span>
                        </button>
                        <button id="m-tour" class="mode-btn" onclick="APP.selectMode('tournament')">
                            <span class="m-emoji">🏆</span>
                            <span class="m-text">錦標賽</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="footer-btns">
                <button class="btn-thick btn-start" onclick="GAME.startPre()">GO</button>
            </div>
        </div>

        <div id="screen-game" class="screen">
            <div class="app-nav-bar">
                <div class="nav-left">
                    <button class="nav-btn" onclick="APP.confirmNavTo('lobby')" style="background: transparent; border: none; box-shadow: none;">
                        <svg viewBox="0 0 24 24" style="width: 22px; height: 22px; fill: #00d2ff;">
                            <path d="M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"/>
                        </svg>
                    </button>
                </div>
                <div class="nav-center" id="player-disp">Player</div>
                <!-- 下面這行改遊戲計時器 -->
				<div class="nav-right" style="font-family:monospace; font-size:1.3rem; font-weight:bold; color:var(--primary-neon);" id="timer">0.00</div>
            </div>
            
            <div id="life-bar-wrap" class="life-bar-container"><div id="life-bar" class="life-bar-fill"></div></div>
            
            <div id="game-grid">
                </div>
        </div>

        <div id="screen-result" class="screen">
            <div style="flex-grow:1; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;">
                <h2 style="color:#aaa; margin:0;">本次成績</h2>
                <div id="res-score" style="font-size:4rem; font-weight:bold; font-family:monospace; margin:10px 0;">0.00s</div>
                <div id="res-detail" style="color:#888; font-size:1rem;">錯誤：0</div>
            </div>
            <div class="footer-btns">
                <button class="btn-thick btn-start" onclick="GAME.retry()">再玩一次</button>
                <button class="btn-thick btn-back" onclick="APP.navTo('lobby')">回大廳</button>
            </div>
        </div>

        <!-- 下面改歷史成績 -->
        <div id="screen-history" class="screen">
            <div class="app-nav-bar">
                <div class="nav-left"><button class="nav-btn" onclick="APP.navTo('lobby')" style="background: transparent; border: none; box-shadow: none;"><svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg></button></div>
                <div class="nav-center" id="hist-title">歷史紀錄</div>
                <div class="nav-right"></div>
            </div>
            <div id="history-list" class="scrollable-y">
                </div>
        </div>

        <div id="screen-f1-setup" class="screen">
            <div class="app-nav-bar">
                <div class="nav-left">
                    <button class="nav-btn" onclick="APP.navTo('input')" style="background: transparent; border: none; box-shadow: none;">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                        </svg>
                    </button>
                </div>
                <div class="nav-center" onclick="F1.triggerDebug()">F1 賽制設定</div>
                <div class="nav-right"></div></div>
            <div class="mode-container scrollable-y">
                <div class="setting-row">
                    <span class="setting-label">參賽人數</span>
                    <div class="stepper-container">
                        <button class="step-btn" onclick="F1.adjustPlayers(-1)">-</button>
                        <div class="step-display" id="disp-f1-players">4</div>
                        <button class="step-btn" onclick="F1.adjustPlayers(1)">+</button>
                    </div>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Round 1 排位賽</span>
                    <select id="sel-r1"></select>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Round 2 衝刺賽</span>
                    <select id="sel-r2"></select>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Round 3 決賽</span>
                    <select id="sel-r3"></select>
                </div>
                
            </div>
            <div class="footer-btns">
                <button class="btn-thick btn-f1-red" onclick="F1.createRace()">進行排位賽</button></div>
        </div>

        <div id="screen-f1-ready" class="screen">
            <div class="ready-box">
                <div style="color:var(--f1-red); font-size:1.5rem; font-weight:bold; margin-bottom:20px;" id="ready-round-title">Round 1</div>
                <div class="next-player-label">Next Driver</div>
                
                <div id="r1-name-input-area" style="width:100%; text-align:center;">
                    <div style="font-size:4rem; font-weight:bold; color:#555; margin-bottom:10px;" id="r1-seat-num">1號</div>
                    <input type="text" id="inp-current-name" class="input-field" style="text-align:center; font-size:2rem; height:70px;">
                </div>
                
                <div id="rx-name-display" class="next-player-name">Player</div>
            </div>
            <div class="footer-btns"><button class="btn-thick btn-f1-red" onclick="F1.goPlay()">GO!</button></div>
        </div>

        <div id="screen-f1-round-result" class="screen">
            <div class="app-nav-bar">
                <div class="nav-center" style="color:var(--f1-red)" id="rr-title">Round 1 Result</div></div>
            <div class="scrollable-y" style="flex-grow:1;">
                <table class="rank-table">
                    <thead>
                        <tr id="rr-thead-row">
                            <th width="10%">#</th>
                            <th>選手</th>
                            <th>Time</th>
                            <th>Pts</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="rr-tbody"></tbody>
                </table>
            </div>
            <div class="footer-btns"><button class="btn-thick btn-f1-red" id="btn-next-round" onclick="F1.nextRound()">下一輪</button></div>
        </div>

        <div id="screen-f1-podium" class="screen f1-theme">
            <div class="app-nav-bar">
                <div class="nav-left"></div>
                <div class="nav-center" sstyle="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <span style="font-size: 2.5rem; line-height: 1;">🏎️</span> 
                    <span style="line-height: 1;">最速傳說</span>
                </div>
                <div class="nav-right"></div>
            </div>
            <div class="podium" id="podium-area"></div>
            <div id="podium-list" class="podium-list scrollable-y"></div>
            <div class="footer-btns"><button class="btn-thick btn-back" onclick="APP.navTo('lobby')">返回首頁</button></div>
        </div>

        <div id="screen-tour-setup" class="screen">
            <div class="app-nav-bar">
                <div class="nav-left">
                    <button class="nav-btn" onclick="APP.navTo('input')" style="background: transparent; border: none; box-shadow: none;"><svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                    </button></div>
                    <div style="height:50px; width:100%; position:absolute; top:0; left:0;" onclick="TOUR.triggerDebug()"></div>
                    <div class="nav-center" onclick="TOUR.triggerDebug()">錦標賽設定</div>
                    <div class="nav-right"></div></div>
            <div class="mode-container">
                <div class="setting-row">
                    <span class="setting-label">參賽人數</span>
                    <div class="stepper-container">
                        <button class="step-btn" onclick="TOUR.adjustPlayers(-1)">-</button>
                        <div class="step-display" id="disp-tour-players">4</div>
                        <button class="step-btn" onclick="TOUR.adjustPlayers(1)">+</button>
                    </div>
                </div>
                <div class="setting-row">
                    <span class="setting-label">賽程規劃</span>
                    <select id="sel-tour-bank"></select>
                </div>
                <div style="height:50px; width:100%; position:absolute; top:0; left:0;" onclick="TOUR.triggerDebug()"></div>
            </div>
            <div class="footer-btns"><button class="btn-thick btn-tour-gold" onclick="TOUR.goToRegistration()">選手報到</button></div>
        </div>

        <div id="screen-tour-reg" class="screen">
            <div class="app-nav-bar"><div class="nav-left"><button class="nav-btn" onclick="APP.navTo('input')" style="background: transparent; border: none; box-shadow: none;"><svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg></button></div><div class="nav-center">登錄參賽選手</div><div class="nav-right"></div></div>
            <div id="reg-list" class="reg-grid scrollable-y"></div>
            <div class="footer-btns"><button class="btn-thick btn-tour-gold" onclick="TOUR.generateBracket()">產生賽程</button></div>
        </div>

        <div id="screen-tour-vs" class="screen tour-theme">
            <div class="vs-container">
                <div class="vs-stage" id="vs-stage-name">第一輪</div>
                
                <div id="vs-card-p1" class="vs-card vs-card-p1">
                    <div class="vs-player" id="vs-p1-name">Player A</div>
                </div>
                
                <div class="vs-v">VS</div>
                
                <div id="vs-card-p2" class="vs-card vs-card-p2">
                    <div class="vs-player" id="vs-p2-name">Player B</div>
                </div>

                <div id="vs-instruction" style="color:#aaa; margin-top:20px; min-height:1.5em; text-align:center;"></div>
            </div>
            <div class="footer-btns"><button class="btn-thick btn-tour-gold" id="btn-tour-action" onclick="TOUR.startMatch()">開始比賽</button></div>
        </div>

        <div id="screen-admin" class="screen">
            <div class="app-nav-bar">
                <div class="nav-left"><button class="nav-btn" onclick="APP.navTo('lobby')" style="background: transparent; border: none; box-shadow: none;"><svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg></button></div><div class="nav-center">管理員後台</div><div class="nav-right"></div></div>
            <div class="admin-menu">
                <button class="btn-admin btn-save" onclick="APP.adminSave()">儲存紀錄</button>
                <button class="btn-admin btn-import" onclick="document.getElementById('file-upload').click()">匯入紀錄</button>
                <input type="file" id="file-upload" class="hidden-file-input" accept=".json" onchange="APP.adminImport(this)">
                <div style="height:30px"></div>
                <button class="btn-admin btn-clear" onclick="APP.adminClear()">⚠️ 清空所有紀錄</button>
            </div>
        </div>

        <div id="pwd-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
            <div style="background:#333; padding:25px; border-radius:15px; text-align:center; box-shadow: 0 0 20px rgba(0,0,0,0.5);">
                <input type="password" id="pwd-input" 
                       inputmode="numeric" pattern="[0-9]*" 
                       style="font-size:2rem; width:140px; text-align:center; background:rgba(255,255,255,0.1); border:1px solid #555; border-radius:10px; color:white; padding:5px; letter-spacing: 5px;" 
                       maxlength="4">
                
                <div style="margin-top:20px; display:flex; gap:30px; justify-content:center;">
                    <button onclick="APP.closePwd()" style="background:transparent; border:none; font-size:1.8rem; cursor:pointer; padding:0; transition:transform 0.1s;" onmousedown="this.style.transform='scale(0.9)'" onmouseup="this.style.transform='scale(1)'">❌</button>
                    <button onclick="APP.checkPwd()" style="background:transparent; border:none; font-size:1.8rem; cursor:pointer; padding:0; transition:transform 0.1s;" onmousedown="this.style.transform='scale(0.9)'" onmouseup="this.style.transform='scale(1)'">✔️</button>
                </div>
            </div>
        </div>

        <div id="debug-overlay" class="debug-overlay" style="display:none;"></div>

    </div>

    <script src="./app.js"></script>
</body>
</html>
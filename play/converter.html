<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ™Ÿè‡ªç„¶ - è¬ç”¨é¡Œåº«è½‰æ›å™¨ (Excel/CSV to JSON)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f4f6f9; color: #333; }
        h2 { color: #2b4b82; border-bottom: 2px solid #2b4b82; padding-bottom: 10px; }
        .container { max-width: 800px; margin: 0 auto; }
        textarea { width: 100%; height: 200px; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-family: monospace; font-size: 14px; box-sizing: border-box; }
        button { 
            background: linear-gradient(135deg, #2b4b82, #1a2e52); 
            color: white; border: none; padding: 12px 30px; 
            font-size: 1.1rem; cursor: pointer; border-radius: 25px; 
            margin: 20px 0; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.2); 
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.96); }
        .step { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .note { color: #e74c3c; font-weight: bold; font-size: 0.9rem; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="step">
            <h2>æ­¥é©Ÿ 1ï¼šè²¼ä¸Š Excel è³‡æ–™</h2>
            <span class="note">â˜… æ”¯æ´ç›´æ¥å¾ Excel è¤‡è£½ (Tab åˆ†éš”) æˆ– CSV æª”æ¡ˆ (é€—è™Ÿåˆ†éš”)</span>
            <p>è«‹å…¨é¸ Excel å…§çš„è³‡æ–™ï¼ˆåŒ…å«ç¬¬ä¸€è¡Œæ¨™é¡Œï¼‰ï¼Œè¤‡è£½ä¸¦è²¼åœ¨ä¸‹æ–¹ï¼š</p>
            <textarea id="input" placeholder="å¹´ç´š    ç« ç¯€    å•é¡Œ    ç­”æ¡ˆ..."></textarea>
        </div>

        <div style="text-align: center;">
            <button onclick="convert()">ğŸ”„ ç«‹å³è½‰æ›ç‚ºç³»çµ±æ ¼å¼</button>
        </div>

        <div class="step">
            <h2>æ­¥é©Ÿ 2ï¼šè¤‡è£½çµæœ</h2>
            <p>è«‹è¤‡è£½ä¸‹æ–¹å…§å®¹ï¼Œä¸¦<b>å®Œå…¨è¦†è“‹</b>åŸæœ¬ <code>data.json</code> æª”æ¡ˆå…§çš„å…§å®¹ï¼š</p>
            <textarea id="output" readonly placeholder="ç­‰å¾…è½‰æ›..."></textarea>
            <div id="status" style="margin-top: 10px; color: #2b4b82; font-weight: bold;"></div>
        </div>
    </div>

    <script>
        function convert() {
            const raw = document.getElementById('input').value.trim();
            if (!raw) { alert("âŒ è«‹å…ˆè²¼ä¸Šè³‡æ–™ï¼"); return; }

            const lines = raw.split('\n');
            const banksMap = {};
            let count = 0;

            // è‡ªå‹•åµæ¸¬åˆ†éš”ç¬¦è™Ÿ (æŠ“ç¬¬ä¸€è¡Œä¾†åˆ¤æ–·)
            let separator = ','; // é è¨­ CSV
            if (lines[0].indexOf('\t') > -1) {
                separator = '\t'; // å¦‚æœç™¼ç¾ Tabï¼Œåˆ‡æ›ç‚º Excel æ¨¡å¼
                console.log("åµæ¸¬æ¨¡å¼ï¼šExcel (Tab)");
            } else {
                console.log("åµæ¸¬æ¨¡å¼ï¼šCSV (Comma)");
            }

            // ç•¥éç¬¬ä¸€è¡Œæ¨™é¡Œï¼Œå¾ç¬¬äºŒè¡Œé–‹å§‹
            for (let i = 1; i < lines.length; i++) {
                let line = lines[i].trim();
                if (!line) continue;
                
                let parts = line.split(separator);
                
                // å¯¬å®¹æ¨¡å¼ï¼šå¦‚æœåˆ‡å‡ºä¾†å°‘æ–¼ 4 æ¬„ï¼Œè©¦è‘—éæ¿¾ç©ºå­—ä¸²å†åˆ‡ä¸€æ¬¡ (æœ‰äº› Excel è¤‡è£½æœƒæœ‰å¥‡æ€ªç©ºç™½)
                if (parts.length < 4) {
                    // å†æ¬¡å˜—è©¦ç”¨å¦ä¸€ç¨®åˆ†éš”ç¬¦è™Ÿåˆ‡åˆ‡çœ‹ï¼Œä»¥é˜²æ··ç”¨
                    let retryParts = line.split(separator === '\t' ? ',' : '\t');
                    if (retryParts.length >= 4) {
                        parts = retryParts;
                    } else {
                        console.warn(`ç¬¬ ${i+1} è¡Œæ ¼å¼ä¼¼ä¹ä¸å®Œæ•´ï¼Œå·²ç•¥é:`, line);
                        continue;
                    }
                }

                // ç§»é™¤å‰å¾Œç©ºç™½èˆ‡å¼•è™Ÿ (Excel æœ‰æ™‚æœƒåŠ å¼•è™Ÿ)
                let grade = parts[0].trim().replace(/^"|"$/g, '');
                let chapter = parts[1].trim().replace(/^"|"$/g, '');
                let q = parts[2].trim().replace(/^"|"$/g, '');
                let a = parts[3].trim().replace(/^"|"$/g, '');

                if(!grade || !chapter || !q || !a) continue;

                // å»ºç«‹ ID
                let bankId = `G${grade}_${chapter}`;
                let bankTitle = `${grade}å¹´ç´š-${chapter}`;

                if (!banksMap[bankId]) {
                    banksMap[bankId] = {
                        id: bankId,
                        title: bankTitle,
                        pairs: []
                    };
                }

                banksMap[bankId].pairs.push({ q: q, a: a });
                count++;
            }

            // --- ä¿®æ”¹é–‹å§‹ (åŒ…å«ä¿®å¾©ç‹€æ…‹é¡¯ç¤º) ---

            // 1. å–å¾—æ‰€æœ‰ç« ç¯€è³‡æ–™
            const banksList = Object.values(banksMap);

            // 2. æ‰‹å‹•çµ„è£ JSON å­—ä¸² (ç‚ºäº†å®¢è£½åŒ–æ’ç‰ˆ)
            // åŠ ä¸Šå‰ç¶´ const GAME_DB = 
            let jsonOutput = "const GAME_DB = {\n    \"banks\": [\n";

            banksList.forEach((bank, bIndex) => {
                jsonOutput += "        {\n";
                jsonOutput += `            "id": "${bank.id}",\n`;
                jsonOutput += `            "title": "${bank.title}",\n`;
                jsonOutput += `            "pairs": [\n`;

                // é‡å°é¡Œç›® (pairs) é€²è¡Œç·Šæ¹Šæ’åˆ—ï¼šæ¯ä¸€é¡Œåªä½”ä¸€è¡Œ
                bank.pairs.forEach((pair, pIndex) => {
                    // å°‡å–®ä¸€ç‰©ä»¶è½‰ç‚ºå­—ä¸²ï¼Œç¢ºä¿å¼•è™Ÿèˆ‡è„«é€¸å­—å…ƒæ­£ç¢º
                    const pairStr = JSON.stringify(pair);
                    
                    // åˆ¤æ–·æ˜¯å¦ç‚ºè©²ç« ç¯€æœ€å¾Œä¸€é¡Œï¼Œæ±ºå®šæ˜¯å¦åŠ é€—è™Ÿ
                    const isLastPair = pIndex === bank.pairs.length - 1;
                    jsonOutput += `                ${pairStr}${isLastPair ? '' : ','}\n`;
                });

                jsonOutput += "            ]\n";
                
                // åˆ¤æ–·æ˜¯å¦ç‚ºæœ€å¾Œä¸€å€‹ç« ç¯€
                const isLastBank = bIndex === banksList.length - 1;
                jsonOutput += `        }${isLastBank ? '' : ','}\n`;
            });

            jsonOutput += "    ]\n};";

            // 3. è¼¸å‡ºçµæœåˆ°æ–‡å­—æ¡†
            document.getElementById('output').value = jsonOutput;
            
            // 4. (ä¿®å¾©) æ›´æ–°ç‹€æ…‹é¡¯ç¤º
            // count è®Šæ•¸ä¾†è‡ªä¸Šæ–¹çš„è¿´åœˆè¨ˆæ•¸ï¼ŒbanksList.length å³ç‚ºç« ç¯€æ•¸
            document.getElementById('status').innerText = `âœ… æˆåŠŸï¼å…±æŠ“åˆ° ${count} é¡Œï¼Œç”Ÿæˆäº† ${banksList.length} å€‹é¡Œåº«ç« ç¯€ã€‚`;

            // --- ä¿®æ”¹çµæŸ ---
            
            if(count === 0) {
                alert("âš ï¸ è½‰æ›çµæœç‚ºç©ºï¼\nè«‹ç¢ºèªæ‚¨æœ‰è¤‡è£½åˆ°å…§å®¹ï¼Œä¸” Excel æ ¼å¼æ­£ç¢ºï¼ˆè‡³å°‘å››æ¬„ï¼‰ã€‚");
            }
        }
    </script>
</body>
</html>